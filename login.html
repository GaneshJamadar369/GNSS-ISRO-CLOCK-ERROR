<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ISRO GNSS AI System - Login</title>
<link rel="shortcut icon" href="https://raw.githubusercontent.com/ab-11-22/assests/main/ISRO-Color.png" type="image/x-icon">
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
    --primary-dark: #020a1a;
    --primary-blue: #0a2a4e;
    --accent-orange: #ff7c42;
    --accent-cyan: #00e5ff;
    --white: #e6f1ff;
    --glass-bg: rgba(2, 10, 26, 0.45);
    --glass-border: rgba(0, 229, 255, 0.2);
    --error-red: #ff4d4d;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:"Inter",sans-serif;background-color:var(--primary-dark);color:var(--white);display:flex;align-items:center;justify-content:center;min-height:100vh;overflow:hidden;}
#bg-canvas{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:-1;}
.login-container{width:75vmin;height:75vmin;aspect-ratio:1/1;max-width:600px;max-height:600px;min-width:320px;min-height:320px;}
.login-card{width:100%;height:100%;background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:15px;backdrop-filter:blur(10px);padding:2rem;text-align:center;box-shadow:0 0 25px rgba(0,229,255,0.15),0 8px 30px rgba(0,0,0,0.3);animation:fadeIn 1s ease-out;position:relative;display:flex;flex-direction:column;justify-content:center;}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
.close-btn{position:absolute;top:1rem;right:1rem;font-size:1.5rem;color:var(--white);opacity:0.7;text-decoration:none;transition:opacity 0.3s ease, transform 0.3s ease;}
.close-btn:hover{opacity:1;transform:rotate(90deg);}
.logo-container{margin-bottom:2rem;}
.logo-container h1{font-size:2rem;font-weight:600;color:var(--white);}
.logo-container p{font-size:1rem;opacity:0.8;margin-top:0.5rem;}
#loginForm{width:100%;}
.form-group{margin-bottom:1.2rem;text-align:left;position:relative;}
.form-icon{position:absolute;left:15px;top:50%;transform:translateY(-50%);color:var(--accent-cyan);opacity:0.6;font-size:1.2rem;}
.form-input{width:100%;padding:14px 15px 14px 45px;background:rgba(2,10,26,0.7);border:1px solid var(--glass-border);border-radius:8px;color:var(--white);font-size:1rem;transition:border-color 0.3s ease, box-shadow 0.3s ease;}
.form-input::placeholder{color:var(--white);opacity:0.6;}
.form-input:focus{outline:none;border-color:var(--accent-cyan);box-shadow:0 0 10px rgba(0,229,255,0.2);}
#togglePassword{position:absolute;top:50%;right:15px;transform:translateY(-50%);color:var(--accent-cyan);opacity:0.6;font-size:1.2rem;}
#togglePassword:hover{opacity:1;}
.captcha-container{display:flex;align-items:center;gap:1rem;margin-bottom:1.2rem;height:45px;width:20px;}
#captchaCanvas{border-radius:6px;flex-grow:1;height:45px !important;}
#refreshCaptcha{background:none;border:1px solid var(--glass-border);border-radius:8px;color:var(--accent-cyan);font-size:1.8rem;cursor:pointer;transition:all 0.3s ease;width:45px;height:45px;display:flex;align-items:center;justify-content:center;}
#refreshCaptcha:hover{transform:rotate(90deg);background:rgba(0,229,255,0.1);}
.error-message{color:var(--error-red);font-size:0.85rem;text-align:left;margin-top:5px;display:none;}
.btn-primary{width:100%;padding:15px;border-radius:8px;font-size:1.1rem;font-weight:700;cursor:pointer;text-align:center;text-decoration:none;transition:transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;background:var(--accent-orange);color:var(--white);border:none;margin-top:1.2rem;}
.btn-primary:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(255,124,66,0.3);background:#ff5e0e;}
.form-footer{display:flex;justify-content:space-between;margin-top:1.5rem;font-size:0.9rem;}
.form-footer a{color:var(--accent-cyan);text-decoration:none;}
.form-footer a:hover{text-decoration:underline;}
#successPopup, #userNotFoundPopup{position: fixed;top:50%;left:50%;transform: translate(-50%, -50%) scale(0);padding: 2rem;border-radius: 12px;text-align: center;font-weight: 600;z-index: 1000;transition: transform 0.3s ease;}
#successPopup{background: rgba(0, 229, 255, 0.95); color: var(--primary-dark);}
#userNotFoundPopup{background: rgba(255, 77, 77, 0.95); color: var(--white);}
#successPopup button, #userNotFoundPopup button{margin-top:1rem;padding: 8px 16px;border: none;border-radius: 6px;background: var(--primary-dark);color: var(--accent-cyan);font-weight: 600;cursor:pointer;}
</style>
</head>
<body>
<canvas id="bg-canvas"></canvas>

<div class="login-container">
    <div class="login-card">
        <a href="index.html" class="close-btn"><i class="ri-close-line"></i></a>
        <div class="logo-container">
            <img src="./images/isro.jpg" alt="ISRO Logo" style="height:50px;">
            <h1>System Access</h1>
            <p>Enter your credentials to continue.</p>
        </div>
        <form id="loginForm" novalidate>
            <div class="form-group">
                <i class="ri-user-3-line form-icon"></i>
                <input type="email" id="username" class="form-input" placeholder="Email / ID" required>
                <div class="error-message" id="usernameError">Email is required.</div>
            </div>
            <div class="form-group">
                <i class="ri-lock-password-line form-icon"></i>
                <input type="password" id="password" class="form-input" placeholder="Password" required>
                <i id="togglePassword" class="ri-eye-line"></i>
                <div class="error-message" id="passwordError">Password is required.</div>
            </div>
            <div class="form-group">
                <div class="captcha-container">
                    <canvas id="captchaCanvas" width="200" height="45"></canvas>
                    <button type="button" id="refreshCaptcha"><i class="ri-refresh-line"></i></button>
                </div>
                <input type="text" id="captchaInput" class="form-input" style="padding-left: 15px;" placeholder="Enter security code" required>
                <div class="error-message" id="captchaInputError">Invalid security code.</div>
            </div>
            <button type="submit" class="btn-primary">Login Securely</button>
            <div class="form-footer">
                <p>Forgot Password?</p>
                <a href="signup.html">Signup</a>
            </div>
        </form>
    </div>
</div>

<div id="successPopup">
    <p id="successPopupMessage">Login Successful!</p>
    <button id="closePopup">Close</button>
</div>

<div id="userNotFoundPopup">
    <p id="userNotFoundMessage">User not found!</p>
    <button id="closeUserNotFound">Close</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
// --- Firebase ---
const firebaseConfig = {
  apiKey: "AIzaSyBWa6uK4v8iotzMhIR90pOh4LrPIPt1XJc",
  authDomain: "isro-b9a7c.firebaseapp.com",
  projectId: "isro-b9a7c",
  storageBucket: "isro-b9a7c.appspot.com",
  messagingSenderId: "262463325741",
  appId: "1:262463325741:web:0052ac0e977f4bc73cdaa4",
  measurementId: "G-RZLD6E6E30"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// --- Animated Background ---
let scene, camera, renderer, particleSystem;
let mouse = new THREE.Vector2();
function init() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.z = 300;

    const canvas = document.getElementById('bg-canvas');
    renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha:true });
    renderer.setSize(window.innerWidth, window.innerHeight);

    const particleCount = 5000;
    const particles = new THREE.BufferGeometry();
    const positions = new Float32Array(particleCount*3);
    for(let i=0;i<positions.length;i++){positions[i]=(Math.random()-0.5)*1000;}
    particles.setAttribute('position', new THREE.BufferAttribute(positions,3));

    const material = new THREE.PointsMaterial({ color:0x00e5ff, size:1.5, blending:THREE.AdditiveBlending, transparent:true, opacity:0.7 });
    particleSystem = new THREE.Points(particles, material);
    scene.add(particleSystem);

    window.addEventListener('resize', onWindowResize, false);
    document.addEventListener('mousemove', onMouseMove, false);
    animate();
}
function animate() {
    requestAnimationFrame(animate);
    particleSystem.rotation.y += 0.0002;
    const positions = particleSystem.geometry.attributes.position.array;
    const time = Date.now()*0.00005;
    for(let i=0;i<positions.length;i+=3){
        const x=positions[i];
        positions[i+1]+=Math.sin(time+x*0.5)*0.3;
    }
    particleSystem.geometry.attributes.position.needsUpdate=true;
    camera.position.x+=(mouse.x*20-camera.position.x)*0.02;
    camera.position.y+=(-mouse.y*20-camera.position.y)*0.02;
    camera.lookAt(scene.position);
    renderer.render(scene,camera);
}
function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight);}
function onMouseMove(event){mouse.x=(event.clientX/window.innerWidth)*2-1;mouse.y=-(event.clientY/window.innerHeight)*2+1;}
init();

// --- CAPTCHA ---
const captchaCanvas = document.getElementById('captchaCanvas');
const ctx = captchaCanvas.getContext('2d');
let captchaText = '';
function generateCaptcha(){
    let result=''; const chars='ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
    for(let i=0;i<6;i++) result+=chars.charAt(Math.floor(Math.random()*chars.length));
    captchaText=result; drawCaptcha();
}
function drawCaptcha(){
    const w=captchaCanvas.width,h=captchaCanvas.height;
    ctx.clearRect(0,0,w,h);
    ctx.fillStyle='rgba(2,10,26,0.5)'; ctx.fillRect(0,0,w,h);
    ctx.font=`bold ${h*0.5}px Inter`; ctx.textAlign='center'; ctx.textBaseline='middle';
    for(let i=0;i<captchaText.length;i++){
        const x=w/(captchaText.length+1)*(i+1);
        const y=h/2+(Math.random()-0.5)*(h*0.2);
        const angle=(Math.random()-0.5)*0.3;
        ctx.save();ctx.translate(x,y);ctx.rotate(angle);
        ctx.fillStyle=`hsl(${200+Math.random()*50},90%,75%)`;ctx.fillText(captchaText[i],0,0);ctx.restore();
    }
}
document.getElementById('refreshCaptcha').addEventListener('click',generateCaptcha);
generateCaptcha();

// --- Password toggle ---
const togglePassword=document.getElementById('togglePassword');
const passwordInput=document.getElementById('password');
togglePassword.addEventListener('click',()=>{const type=passwordInput.type==='password'?'text':'password';passwordInput.type=type;togglePassword.className=type==='password'?'ri-eye-line':'ri-eye-off-line';});

// --- Popups ---
const successPopup=document.getElementById('successPopup');
const successPopupMessage=document.getElementById('successPopupMessage');
document.getElementById('closePopup').addEventListener('click',()=>{successPopup.style.transform='translate(-50%, -50%) scale(0)';});
const userNotFoundPopup=document.getElementById('userNotFoundPopup');
document.getElementById('closeUserNotFound').addEventListener('click',()=>{userNotFoundPopup.style.transform='translate(-50%, -50%) scale(0)';});
function showPopup(message){successPopupMessage.textContent=message;successPopup.style.transform='translate(-50%, -50%) scale(1)';setTimeout(()=>{successPopup.style.transform='translate(-50%, -50%) scale(0)';},3000);}
function showUserNotFound(message){document.getElementById('userNotFoundMessage').textContent=message;userNotFoundPopup.style.transform='translate(-50%, -50%) scale(1)';setTimeout(()=>{userNotFoundPopup.style.transform='translate(-50%, -50%) scale(0)';},3000);}

// --- Form Login ---
document.getElementById('loginForm').addEventListener('submit', e=>{
    e.preventDefault();
    ['username','password','captchaInput'].forEach(id=>document.getElementById(id+'Error').style.display='none');
    const username=document.getElementById('username').value.trim();
    const password=document.getElementById('password').value;
    const captchaInput=document.getElementById('captchaInput').value.trim();
    let valid=true;
    if(username===''){document.getElementById('usernameError').style.display='block';valid=false;}
    if(password===''){document.getElementById('passwordError').style.display='block';valid=false;}
    if(captchaInput.toUpperCase()!==captchaText){document.getElementById('captchaInputError').style.display='block';generateCaptcha();document.getElementById('captchaInput').value='';valid=false;}
    if(!valid) return;

    db.collection('users').doc(username).get().then(doc=>{
        if(doc.exists){
            if(doc.data().password===password){
                showPopup(`Welcome, ${doc.data().fullName}!`);
                document.getElementById('loginForm').reset();
                generateCaptcha();
                // --- Redirect to clock.html after 1.5s ---
                setTimeout(()=>{ window.location.href='index.html'; },1500);
            }else{
                showUserNotFound('Incorrect password!');
                generateCaptcha();
                document.getElementById('captchaInput').value='';
            }
        }else{
            showUserNotFound('User not found!');
            generateCaptcha();
            document.getElementById('captchaInput').value='';
        }
    }).catch(err=>{
        showUserNotFound('Error: '+err.message);
    });
});
</script>
</body>
</html>
